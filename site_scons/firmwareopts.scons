Import("ENV")


ENV.Append(
    CPPDEFINES=[
        "FURI_DEBUG" if ENV["DEBUG"] else "FURI_NDEBUG",
        "DEBUG" if ENV["DEBUG"] else "NDEBUG",
    ],
    CCFLAGS=[
        "-Os" if ENV["COMPACT"] else "-Og",
    ],
)

ENV.AppendUnique(
    LINKFLAGS=[
        "-specs=nano.specs",
        "-Wl,--gc-sections",
        "-Wl,--wrap,_malloc_r",
        "-Wl,--wrap,_free_r",
        "-Wl,--wrap,_calloc_r",
        "-Wl,--wrap,_realloc_r",
        "-n",
        "-Xlinker",
        "-Map=${TARGET}.map",
        "-T${LINKER_SCRIPT_PATH}",
    ],
)

ENV.Append(
    IMAGE_BASE_ADDRESS="0x8000000",
    LINKER_SCRIPT_PATH=ENV["TARGET_CFG"].linker_script_flash,
    APP_LINKER_SCRIPT_PATH=ENV["TARGET_CFG"].linker_script_app,
)
